<head>
  <script src="pixi.min.js" type="text/javascript"></script>
  <script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      $("#file-input").on('change', (e) => {
        let file = e.target.files[0];
        let meshReader = new FileReader();

        meshReader.addEventListener("load", function(event) {
          let textFile = event.target;
          const data = textFile.result.split(/\n|\r\n/);

          data.shift();
          data.shift();
          const totalPoints = Number(data[0].split(' ')[0]);
          const totalPolygons = Number(data[0].split(' ')[1]);
          data.shift();
          const pointsArr = data.slice(0, totalPoints).map((pointLine) => pointLine.split(" ").slice(0, 2)).map((pt) => [parseInt(pt[0]), parseInt(pt[1])]);
          let maxX = Math.max.apply(null, pointsArr.map((p) => p[0]));
          let maxY = Math.max.apply(null, pointsArr.map((p) => p[1]));
          const polygonData = data.slice(totalPoints, data.length);
          let polygonsArr = [];
          polygonData.forEach((polygonLine) => {
            let pts = polygonLine.split(" ")
            let totalPolygonPoints = parseInt(pts[0])
            let points = pts.slice(1, totalPolygonPoints + 1).map((pt) => pointsArr[parseInt(pt)]);
            polygonsArr.push(points);
          });
          console.log("meshData", totalPoints, totalPolygons, pointsArr, polygonsArr, maxX, maxY);

          const meshData = {
            totalPoints: totalPoints,
            totalPolygons: totalPolygons,
            pointsArr: pointsArr,
            polygonsArr: polygonsArr,
            maxX: maxX,
            maxY: maxY
          };
          poc(meshData);
        });
        meshReader.readAsText(file);
      });

      function poc(data) {
        canvas = document.createElement("canvas");
        canvas.id = "canvas";
        document.body.appendChild(canvas);
        height = data.maxY;
        width = data.maxX;
        app = new PIXI.Application({
          width: width*21,
          height: height*21,
          view: canvas,
          transparent: true,
          antialias: true
        });
        renderer = app.renderer;
        stage = app.stage;
        renderer.render(stage);
        container = new PIXI.Container();
        for (let i = 0; i < data.polygonsArr.length; ++i) {
          let points = data.polygonsArr[i].flat();
          points = points.concat(points.slice(0, 2)).map((pt) => pt * 20);
          let polygon = new PIXI.Graphics();
          polygon.lineStyle(1, 0x000000);
          polygon.beginFill(0xFFFFFF);
          polygon.drawPolygon(points);
          polygon.endFill();
          container.addChild(polygon);
        }
        stage.addChild(container);
      }
    });
  </script>
</head>

<body style="background: #ddd;">
  <input type="file" id="file-input" />
</body>
