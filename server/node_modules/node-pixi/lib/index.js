'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.Canvas = exports.PIXI = undefined;

var _dom = require('./dom');

var dom = _interopRequireWildcard(_dom);

var _pixi = require('pixi.js');

var PIXI = _interopRequireWildcard(_pixi);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

var Canvas = dom.Canvas;

/**
 * Patches PIXI loader's onComplete.
 * When using WebGLRenderer images need to be converted to ImageData as
 * glTexture doesn't like node-canvas Image.
 */
function monkey_patch_loader() {
    var fn = PIXI.loader.onComplete.add;
    PIXI.loader.onComplete.add = function (cb) {
        var f = function f(m) {
            Object.keys(m.resources).forEach(function (key) {
                var source = m.resources[key].texture.baseTexture.source;
                if (source instanceof Image) {
                    m.resources[key].texture.baseTexture.source = Canvas.imageToImageData(source);
                }
            });
            cb(m);
        };
        return fn.apply(this, [f]);
    };
}

monkey_patch_loader();

exports.PIXI = PIXI;
exports.Canvas = Canvas;